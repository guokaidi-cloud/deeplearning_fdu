# YOLOv8 人脸检测模型配置文件
# 基于官方YOLOv8n模型架构，针对人脸检测任务进行优化

# 模型参数
nc: 1  # 类别数量 (人脸)
scales: # 模型缩放参数 (depth, width, max_channels)
  n: [0.33, 0.25, 1024]  # YOLOv8n
  s: [0.33, 0.50, 1024]  # YOLOv8s  
  m: [0.67, 0.75, 768]   # YOLOv8m
  l: [1.00, 1.00, 512]   # YOLOv8l
  x: [1.00, 1.25, 512]   # YOLOv8x

# 骨干网络 (backbone)
backbone:
  # [from, repeats, module, args]
  - [-1, 1, Conv, [64, 3, 2]]  # 0-P1/2
  - [-1, 1, Conv, [128, 3, 2]] # 1-P2/4
  - [-1, 3, C2f, [128, True]]
  - [-1, 1, Conv, [256, 3, 2]] # 3-P3/8
  - [-1, 6, C2f, [256, True]]
  - [-1, 1, Conv, [512, 3, 2]] # 5-P4/16
  - [-1, 6, C2f, [512, True]]
  - [-1, 1, Conv, [1024, 3, 2]] # 7-P5/32
  - [-1, 3, C2f, [1024, True]]
  - [-1, 1, SPPF, [1024, 5]]  # 9

# 颈部网络 (head)
head:
  - [-1, 1, nn.Upsample, [None, 2, 'nearest']]
  - [[-1, 6], 1, Concat, [1]]  # cat backbone P4
  - [-1, 3, C2f, [512]]  # 12

  - [-1, 1, nn.Upsample, [None, 2, 'nearest']]
  - [[-1, 4], 1, Concat, [1]]  # cat backbone P3
  - [-1, 3, C2f, [256]]  # 15 (P3/8-small)

  - [-1, 1, Conv, [256, 3, 2]]
  - [[-1, 12], 1, Concat, [1]]  # cat head P4
  - [-1, 3, C2f, [512]]  # 18 (P4/16-medium)

  - [-1, 1, Conv, [512, 3, 2]]
  - [[-1, 9], 1, Concat, [1]]  # cat head P5
  - [-1, 3, C2f, [1024]]  # 21 (P5/32-large)

  - [[15, 18, 21], 1, Detect, [nc]]  # Detect(P3, P4, P5)

# 模型特定配置
model_config:
  # 激活函数
  activation: 'SiLU'  # 或 'ReLU', 'Hardswish'
  
  # 归一化层
  normalization: 'BatchNorm2d'  # 或 'GroupNorm', 'LayerNorm'
  
  # 注意力机制 (可选)
  attention: null  # 或 'SE', 'CBAM', 'ECA'
  
  # Dropout
  dropout: 0.0
  
  # 深度可分离卷积
  depthwise: false
  
# 损失函数配置
loss_config:
  # 边界框损失
  box_loss_gain: 7.5
  cls_loss_gain: 0.5
  dfl_loss_gain: 1.5
  
  # 焦点损失参数
  fl_gamma: 1.5  # focal loss gamma
  
  # 标签平滑
  label_smoothing: 0.0

# 优化器配置
optimizer_config:
  optimizer: 'SGD'  # 或 'Adam', 'AdamW'
  lr0: 0.01         # 初始学习率
  lrf: 0.01         # 最终学习率 (lr0 * lrf)
  momentum: 0.937   # SGD动量
  weight_decay: 0.0005  # 权重衰减
  warmup_epochs: 3.0    # 预热轮数
  warmup_momentum: 0.8  # 预热动量
  warmup_bias_lr: 0.1   # 预热偏置学习率

# 学习率调度器
scheduler_config:
  scheduler: 'linear'  # 或 'cosine', 'polynomial', 'constant'
  
# NMS配置
nms_config:
  conf_thres: 0.25     # 置信度阈值
  iou_thres: 0.45      # IoU阈值
  max_det: 300         # 最大检测数量
  agnostic: false      # 类别无关NMS
  multi_label: false   # 多标签NMS
  
# 输入配置
input_config:
  imgsz: 640          # 输入图像尺寸
  stride: 32          # 最大步长
  
# 锚框配置 (YOLOv8使用anchor-free方式，此处仅为参考)
anchor_config:
  anchors: 3          # 每层锚框数量
  anchor_t: 4.0       # 锚框阈值倍数
